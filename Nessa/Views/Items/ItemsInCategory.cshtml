@model IPagedList<Nessa.Models.Item>
@using Nessa.Models
@using PagedList
@using PagedList.Mvc

@{
    ViewBag.Title = "ItemsInCategory";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@if (!Model.Any())
{
    <h2 style="margin: 50px; text-align: center">Няма намерени продукти!</h2>

    <p>
        @using (Html.BeginForm("ItemsInCategory", "Items", FormMethod.Get, new { @class="form-wrapper cf" }))
        {
            @Html.TextBox("search") <button type="submit">Търси!</button>
        }
    </p>
}
else
{
    <h2 style="margin: 50px; text-align: center">@Model.ElementAt(0).Category.Name</h2>

    <p>
        @using (Html.BeginForm("ItemsInCategory", "Items", FormMethod.Get, new { @class="form-wrapper cf" }))
        {
            @Html.TextBox("search") <button type="submit">Търси!</button>
        }
    </p>

    <div class="container">
        <div id="oneItem" class="row">
            @foreach (var item in Model)
            {

                <div class="col-md-4" id="@item.Id" style="margin-bottom: 100px">
                    <figure class="card card-product">
                        @if (item.Images.Count > 0)
                        {
                            <a href="/Items/Details/@item.Id"><div class="img-wrap"><img src="~/Images/@item.Images.ElementAt(0).Path"></div></a>
                        }
                        else
                        {
                            <a href="/Items/Details/@item.Id"><div class="img-wrap"><img src="data:image/jpeg;base64,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"></div></a>
                        }
                        <figcaption class="info-wrap">
                            <a href="/Items/Details/@item.Id"><h4 class="title">@item.Name</h4></a>
                            <p class="desc">@item.Description</p>
                        </figcaption>
                        <div class="bottom-wrap">
                            <div class="price-wrap h5">
                                <span class="price-new">@item.Price лв.</span>
                            </div> <!-- price-wrap.// -->
                            @if (User.IsInRole(RoleName.Admin))
                            {
                                @Html.ActionLink("Редактирай", "Edit", "Items", new { id = item.Id }, null)
                                <br>
                                @*@Html.ActionLink("Изтрии", "Remove", "Items", new { id = item.Id }, null)*@
                                <button class="js-delete" data-item-id="@item.Id">Изтрии</button>
                            }
                        </div> <!-- bottom-wrap.// -->
                    </figure>
                </div> <!-- col // -->
            }
        </div> <!-- row.// -->
    </div>
    <!--container.//-->
    @Html.PagedListPager(Model, page => Url.Action("ItemsInCategory", new { page, search = Request.QueryString["search"] }))
}

@section scripts
{
    <script>
        $(document).ready(function () {
            $("#oneItem").on("click", ".js-delete", function () {
                var button = $(this);

                bootbox.confirm("Сигурен ли си, че искаш да изтриеш този продукт?", function (result) {
                    if (result) {
                        $.ajax({
                            url: "/api/items/" + button.attr("data-item-id"),
                            method: "DELETE",
                            success: function () {
                                $('#' + button.attr("data-item-id")).remove();
                                $("#oneItem").load(location.href + " #oneItem>*", "");
                            }
                        });
                    }
                });
            })
        });
    </script>
}